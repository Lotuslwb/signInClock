(function(){var nativeCallBack={},callbackIndex=0,ua=navigator.userAgent.toLowerCase(),iframe;var deviceType=!!window.jscall?"android":"ios";function parse(jsonStr){return JSON.parse(jsonStr)}function str(obj){return JSON.stringify(obj)}function encode(str){return encodeURIComponent(str)}function decode(str){return decodeURIComponent(str)}function encodeStr(obj){return encode(str(obj))}function parseDecode(jsonStr){return parse(decode(jsonStr))}function merge(src,obj){for(var i in obj){src[i]=obj[i]}console.log(src);return src}function getArgs(fnArgs,offset){return Array.prototype.slice.call(fnArgs,offset||0)}function wrapperFn(fn){if(typeof fn=="function"){return}}function defineProperty(obj,propName,getter){Object.defineProperty(obj,propName,{get:getter})}function registCallback(callback,keepCb){callbackIndex++;var callbackName="cb_"+callbackIndex;nativeCallBack[callbackName]=function(){var res=getArgs(arguments);callback.apply(ya,res);if(!keepCb){nativeCallBack[callbackName]=null}};return callbackName}function loadUrl(url){if(iframe){document.documentElement.removeChild(iframe)}iframe=document.createElement("iframe");iframe.setAttribute("width",0);iframe.style.display="none";iframe.setAttribute("src",url);document.documentElement.appendChild(iframe);setTimeout(function(){iframe&&document.documentElement.removeChild(iframe);iframe=null},0)}function gapCall(functionName){if(!/iting/i.test(ua)){return}var args=getArgs(arguments,1);var callback=args[args.length-1];var needCallback=true;var isIos=deviceType=="ios";var isAsync=(functionName.indexOf("_async")!==-1);var keepCb=(functionName.indexOf("_long")!==-1);functionName=functionName.replace(/(_async|_long)/g,"");if(typeof callback!="function"){needCallback=false;if(callback===undefined){args=args.slice(0,args.length-1)}}else{args=args.slice(0,args.length-1)}if(isIos||isAsync){var callbackName="null";if(needCallback){callbackName=registCallback(callback,keepCb)}}if(isIos){var scheme="jscall://"+functionName+"&"+callbackName;try{if(ua.match(/(iphone|ipad).* os (\d+\_\d+(\_\d+)*)/)[2].split("_")[0]>=10){scheme=scheme.replace(/^(jscall:\/\/)/,"$1xmly?")}}catch(e){}if(args){for(var i in args){scheme+="&"+args[i]}}loadUrl(scheme)}else{var nativeFn=window.jscall[functionName];if(isAsync){args.unshift(callbackName);nativeFn.apply(window.jscall,args)}else{var res=nativeFn.apply(window.jscall,args);if(needCallback){callback(res)}}}}function extend(a,b){var k;if(typeof b!=="object"){return a}for(k in b){if(b.hasOwnProperty(k)){if(b[k]!=undefined){a[k]=b[k]}}}return a}var ya={_schemeList:{"default":"iting","com.gemd.iting":"itinggemd","com.qndzq.book":"itingqndzq","com.jima.yijingtingshu":"itingjima"},isAndroid:deviceType=="android",isIos:deviceType=="ios",setScheme:function(impl){if(this._schemeList.hasOwnProperty(impl)){this.device.scheme=this._schemeList[impl]}else{this.device.scheme=this._schemeList["default"]}},device:{name:"",version:"",platformVersion:"",uuid:"",uid:"",token:"",scheme:"iting"},registModule:function(moduleName,module){var self=this;defineProperty(module,"$ref",function(){return self});defineProperty(self,moduleName,function(){return module})},toast:function(msg){gapCall("notificationToast",encode(msg))},copy:function(msg){gapCall("copy",encode(msg))},closeWebView:function(){gapCall("closeWebView")},browse:function(url){gapCall("browse",encode(url))},login:function(cb){gapCall("login_async",function(data){cb&&cb.call(this,parse(data))})},getNetworkStatus:function(cb){gapCall("getNetworkStatus_async",function(data){cb&&cb.call(this,parse(data))})},getVersion:function(){return(this.device.version||ua.match(/(kdtunion_iting|iting|iting\(\w+\))\/(\d(\.\d{1,3}){2,3})/)[2])},ready:function(callbback){var self=this;gapCall("appReady",function(obj){var devInfo=self.device;obj=JSON.parse(obj);devInfo.platformVersion=obj.platformVersion;devInfo.name=window.jscall?"android":"ios";devInfo.platform=obj.platform;devInfo.version=obj.version;devInfo.uuid=obj.deviceId;devInfo.uid=obj.uid;devInfo.token=obj.token;devInfo.idfa=obj.idfa||"";callbback.call(self,devInfo)})},onShare:function(cb){if(cb===false){gapCall("onShare")}else{gapCall("onShare_async_long",function(){cb&&cb.call(this)})}},share:function(param,cb){gapCall("share_async",encodeStr(param),function(obj){cb&&cb.call(this,parseDecode(obj))})},multiShare:function(param,cb){gapCall("multiShare_async",encodeStr(param),function(obj){cb&&cb.call(this,parseDecode(obj))})},_wrapFn:function(fn,flag){var keepCb=true;if(typeof flag=="boolean"&&!flag){keepCb=false}if(typeof fn=="function"){return registCallback(fn,keepCb)}else{if(typeof fn=="object"){for(var i in fn){fn[i]=this._wrapFn(fn[i],flag)}}}return fn},getScheme:function(type,obj){var protocol=this.device.scheme,str=this.paramStr(obj);str.length>0&&(str="&"+str);return protocol+"://open?msg_type="+type+str},open:function(url){if(!/:\/\/open/.test(url)){url=this.getScheme.apply(this,arguments)}loadUrl(url)}};ya.registModule("recorder",{recorderEvents:{},addRecordText:function(info,cb){gapCall("addRecordText_async",encodeStr(info),function(){cb&&cb.apply(this,arguments)
})},startRecord:function(cb){gapCall("startRecord_async",function(){cb&&cb.apply(this,arguments)})},pauseRecord:function(cb){gapCall("pauseRecord_async",function(){cb&&cb.apply(this,arguments)})},resumeRecord:function(id,cb){gapCall("resumeRecord_async",id,function(){cb&&cb.apply(this,arguments)})},stopRecord:function(cb){gapCall("stopRecord_async",function(){cb&&cb.apply(this,arguments)})},playVoice:function(id,cb){gapCall("playVoice_async",id,function(){cb&&cb.apply(this,arguments)})},pauseVoice:function(id,cb){gapCall("pauseVoice_async",id,function(){cb&&cb.apply(this,arguments)})},resumeVoice:function(id,cb){gapCall("resumeVoice_async",id,function(){cb&&cb.apply(this,arguments)})},stopVoice:function(id,cb){gapCall("stopVoice_async",id,function(){cb&&cb.apply(this,arguments)})},getUploadProgress:function(id,cb){gapCall("getUploadProgress_async",id,function(){cb&&cb.apply(this,arguments)})},uploadVoice:function(id,cb){var url="http://upload.ximalaya.com/dtres/audio/upload?callerSource=thirdparty";gapCall("uploadVoice_async",id,url,1,function(){cb&&cb.apply(null,arguments)})},_addEvent:function(event,fn){var self=this;self.recorderEvents[event]=fn;defineProperty(this,event,function(){return self.recorderEvents[event].bind(self.$ref)})},bind:function(param,fn){if(typeof param=="object"){for(i in param){this._addEvent(i,param[i])}}else{if(typeof param=="string"){this._addEvent(param,fn)}}}});var nativeCall={getTitle:function(){var el=document.getElementsByTagName("title")[0];var title=el.innerText;if(window.jscall&&window.jscall.getTitle){window.jscall.getTitle(title)}else{return title}},redirectTo:function(url){window.location.href=url},resizeWin:function(){window.resizeBy(0,0)},getCookie:function(name){var res=ya.cookie(name)||"",obj={};obj[name]=res;if(window.jscall&&window.jscall.passCookie){window.jscall.passCookie(encodeStr(obj))}else{return res}}};if(ya.recorder){defineProperty(nativeCall,"recorder",function(){return ya.recorder})}window.ya=ya;window.nativeCallBack=nativeCallBack;window.nativeCall=nativeCall})();